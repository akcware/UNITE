<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Government Supervisor Dashboard - UNITE</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="A cool thing made with Glitch">
  <link id="favicon" rel="icon" href="https://glitch.com/edit/favicon-app.ico" type="image/x-icon">
  <link rel="stylesheet" href="/style.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
  <script src="/https.js"></script>
  <script src="/autocomp.js"></script>
  <script type="text/javascript">
    $(document.ready(function() {
      var token = $("input[name='_csrf']").val();
      
      $('button[id^="process"]').click(function(e) {
        var tr = $(this).parent('tr');
        var id = $(this).attr('id');
        
        if(confirm('Are you sure you want to remove the selected buyer from the UNITE Platform?')) {
          $.ajax({
              url: "/processBuyer",
              headers: { "X-CSRF-Token": token },
              datatype: "application/json",
              type: "POST",
              data: {"id": id},
              success: function(data) {
                //res(data);
                tr.remove();
                alert('The Buyer has been removed!');
              },
              error: function(err) {
                alert(err);
              }
            });
          }
      });
    });
  </script>
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <a class="navbar-brand" href="/supervisor">Supervisor - UNITE</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item active">
          <a class="nav-link" href="/supervisor">Dashboard <span class="sr-only">(current)</span></a>
        </li>
      </ul>
      <ul class="navbar-nav">
        <li class="nav-item active">
          <a class="btn btn-primary" href="/supervisor/profile">Profile</a>
        </li>
        <br>
        <li class="nav-item">
          <a class="btn btn-danger" href="?exit=true">Logout</a>
        </li>
      </ul>
    </div>
  </nav>
  
  <div class="container mt-4">
    <div>  
      <input type="button" class="btn btn-primary" value="Back" onclick="history.go(-1)">
    </div>
    <div class="card">
      <div class="card-header">
        Hello!
      </div>
      <div class="card-body">
        <h5 class="card-title">Hello, <%= supervisor.organizationName %>!</h5>
        <p>With your UNITE ID, new buyers can register on the website and start searching for suppliers. If you change the UNITE ID, please announce your members.</p>
        <div class="form-group">
          <label>Your Unique Unite ID</label>
          <input type="text" class="form-control" readonly value="<%= supervisor.organizationUniteID %>">
        </div>
      </div>
    </div>
  </div>
<% if(buyers != null && buyers.length > 0) {%>
  <div class="container mt-4">
    <table class="table table-striped table-hover">
      <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">Dept Agency Group</th>
          <th scope="col">Contact Name</th>
          <th scope="col">Balance</th>
          <th scope="col">isActive</th>
          <th scope="col">Process</th>
        </tr>
      </thead>
      <tbody>
        <% console.log(buyers + ' NIL ' + buyers.length) %>
        <% let i = 0; for (buyer of buyers) { %>
        <tr id="<%= buyer._id %>">
          <td scope="col"><%= i %></td>
          <td scope="col"><%= buyer.deptAgencyGroup %></td>
          <td scope="col"><%= buyer.contactName %></td>
          <td scope="col">â‚¬<%= buyer.balance %></td>
          <td scope="col">YES</td>
          <td scope="col">
            <button title="Remove selected Buyer from UNITE" id="process_<%= i %>" class="btn btn-primary">Process</button>
          </td>
        </tr>
        <% i++; } } else {%>
        <div>
          <p style="color: green; font-family: arial">
            Sorry, no buyers with your Organization UNITE ID are currently available. Please wait for their registration
          </p>
          <!-- <input type="hidden" name="_csrf" value="< %= csrfToken %>" > -->
        </div>
        <% }%>
      </tbody>
    </table>
  </div>
</body>

</html>