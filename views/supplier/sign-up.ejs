<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Sign up as Supplier - UNITE</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="A cool thing made with Glitch">
  <link id="favicon" rel="icon" href="https://glitch.com/edit/favicon-app.ico" type="image/x-icon">
  <link rel="stylesheet" href="/style.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
  integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
  <script src="/autocomp.js"></script>
  <script src="/https.js"></script>
  
  <script type="text/javascript">
      $(document).ready(function () {
      var token = $("input[name='_csrf']").val();
        
      postAutocomplete('.country', '/countryAutocomplete', token);
      getAutocomplete('#industry', '/industryGetAutocomplete', token);
      getAutocomplete('#currency', '/currencyGetAutocomplete', token);
    
      $('input.fileupload')/*.unbind('change')*/.bind('change', function () {
        $(this).val ? $(this).next('input').removeAttr('disabled') : $(this).next('input').attr('disabled', 'disabled');
      });
        
      $('#updateProfile').click(function() {
        if($('#prodServices li').length == 0) {
          var obj = '<p class="productRequired littleNote">You are required to include at least one product or service.</p>';
          $(obj).insertBefore($(this));
          return false;
        }
      });        
        
      $('.single,.multiple').each(function(index, element) {
        var val = $(this).prev('.fileupload').attr('value');
        
        if(val) {
          $(this).prev('.fileupload').val(val);
          if(val.charAt(val.length-1) == ',') {//Multi
            var newVal = val.substring(0, val.length-1);
            newVal = newVal.split(',');
            for(var i in newVal) {
              var ob = '<a href="' + newVal[i] + '" download>Download file "'+i+'"</a>';
              $(ob).insertAfter($(this).parent('div'));
            }
          } else {
            var ob = '<a href="' + val + '" download>Download</a>';
            $(ob).insertAfter($(this).parent('div'));  
          }
        }
      });
        
      $('.single,.multiple').click(function (e) {
        var input = $(this).prev('.fileupload'); 
        
        var isMultiple = $(this).hasClass('multiple')? true : false;
        var formData = new FormData();
        formData.append("_csrf", token);
        formData.append("upload_file", true);
        
        if(isMultiple == false) {
          formData.append('single', input[0].files[0]);          
        }
        else {
          $.each(input[0].files, function(i, file) {
            formData.append('multiple', file);
          });
        }
        
        var theUrl = isMultiple == true? "/uploadmultiple" : "/uploadfile";
        var xhr = new XMLHttpRequest();
        xhr.open('POST', theUrl, true);
        xhr.setRequestHeader('X-CSRF-TOKEN', token);
        xhr.onload = function(e) {
        };
        
        xhr.send(formData);
        xhr.onreadystatechange = function() {
          if (xhr.readyState === 4) {
              var ob, val, response = JSON.parse(xhr.responseText);
              if(isMultiple) {
                for(var i in response) {
                  val = input.attr('value') + '/' + response[i].path + ',';                  
                  //input.val(val);
                  input.attr('value', val);                  
                  ob = '<a href="/' + response[i].path + '" download>Download file "'+i+'"</a>';
                  $(ob).insertAfter(input.parent('div'));
                }
              } else {                
                val = '/' + response.path + ',';                  
                //input.val(val);
                input.attr('value', val);
                ob = '<a href="/' + response.path + '" download>Download file</a>';
                $(ob).insertAfter(input.parent('div'));
              }
              
              if (xhr.status === 200) {
                 console.log('successful');
              } else {
                 console.log('failed');
              }
          }
        };
        
        e.preventDefault();
      });
        
    $('.cb').click(function() {
      if($(':checkbox:checked').length == 2) {
        $('#submit').removeAttr('disabled');
      } else {
        $('#submit').attr('disabled', 'disabled');
      }
    });
        
    $('#prodServiceInput').bind('change', function() {
      if($(this).val()) {
        $('#addProdService').removeAttr('disabled');
      } else {
        $('#addProdService').attr('disabled', 'disabled');
      }
    });
        
     $("#addProdService").click(() => {
        var input = $("#prodServiceInput");
        var prodInput = $("#prodServicesList");
        var priceInput = $("#pricesList");
        var currencyInput = $("#currenciesList");
     
        if(input.val() != "") {          
          var elem = (document.getElementById("prodServices"));
          elem.insertAdjacentHTML("beforeend", "<li class='list-group-item'><span>" + $("#prodServiceInput").val() + ' - ' + $('#price').val() + ' ' + $('#currency').val() + "</span><span class='rem'>&nbsp;(Remove)</span></li>");
          elem = $(elem);
          
          var prodVal = input.val();
          var arr = prodInput.val().split(',');
          arr.push(prodVal);
          prodInput.val((arr));
          
          prodVal = $('#price').val();
          arr = priceInput.val().split(',');
          arr.push(prodVal);
          priceInput.val((arr));
          
          prodVal = $('#currency').val();
          arr = currencyInput.val().split(',');
          arr.push(prodVal);
          currencyInput.val((arr));

          $('.rem').unbind('click').bind('click', function() {
            var li = $(this).parent('li');
            var newIndex = elem.find('li').index(li);
            var arr = prodInput.val().split(',');
            arr.splice(newIndex, 1);
            prodInput.val((arr));
            arr = priceInput.val().split(',');
            arr.splice(newIndex, 1);
            priceInput.val((arr));
            arr = currencyInput.val().split(',');
            arr.splice(newIndex, 1);
            currencyInput.val((arr));
            $("#prodServiceInput").trigger('change');
            li.remove();
          });

          input.val('');
          $('#price').val('');
          $('#curency').val('');
          
          $('.productRequired').remove();
        }
    });
  });
  </script>
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark" style="width: 100% !important;">
    <a class="navbar-brand" href="/">UNITE</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
  </nav>

  <div class="container">
    <div>  
        <input type="button" class="btn btn-primary" value="Back" onclick="history.go(-1)">
    </div>

    <div class="mx-auto text-center mt-4">
      <a href="/">
        <img src="https://cdn.glitch.com/e38447e4-c245-416f-8ea1-35b246c6af5d%2Funite.png?v=1587840844949" height="150">
      </a>
    </div>

    <% if (errorMessage.length > 0) { %>
    <script>
      Swal.fire({
        icon: 'error',
        title: 'Oops...',
        text: '<%= errorMessage %>',
      })
    </script>
    <% } %>
    <div class="sign-in-form smooth-shadow">
      <form method="POST">
        <h2>Sign up as Supplier</h2>
        <input type="hidden" name="priceList" id="priceList">
        <input type="hidden" name="currencyList" id="currencyList">
        <div class="form-group">
          <label class="text-muted form-text">
            Please fill in all the required (*) fields.
          </label>
        </div>
        <div class="form-group">
          <label>Company Name*</label>
          <input type="text" class="form-control" name="companyName" required>
        </div>
        <div class="form-group">
          <label>Email address*</label>
          <input type="email" class="form-control" name="emailAddress" required>
          <small class="text-muted form-text">Only companies' domains are allowed.</small>
        </div>
        <div class="form-group">
          <label for="password">Password*</label>
          <input type="password" pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{6,}" title="Please type at least one number and one uppercase&lowercase letter, and at least 6 characters" class="form-control" id="password" name="password" required>
        </div>
        <div class="form-group">
          <label>Director's name*</label>
          <input type="text" class="form-control" name="directorsName" required>
        </div>
        <div class="form-group">
          <label>Contact Name*</label>
          <input type="text" class="form-control" name="contactName" required>
        </div>
        <div class="form-group">
          <label>Title*</label>
          <input type="text" class="form-control" name="title" required>
        </div>
        <div class="form-group">
            <label>Company Registration No*</label>
            <input type="text" class="form-control" name="companyRegistrationNo" required>
          </div>
        <div class="form-group">
          <label>Registered Country*</label>
          <input type="text" class="form-control" name="registeredCountry" required>
        </div>
        <div class="form-group">
          <label>Company Address*</label>
          <input type="text" class="form-control" name="companyAddress" required>
        </div>
        <div class="form-group">
          <label>Area Covered</label>
          <input type="text" class="form-control" name="areaCovered">
        </div>
        <div class="form-group">
          <label>Contact Mobile Number*</label>
          <input type="tel" class="form-control" name="contactMobileNumber" required>
        </div>
        <div class="form-group">
          <label>Country*</label>
          <input type="text" class="form-control" id="country" name="country" required>
        </div>
        <div class="form-group">
          <label>Industry*</label>
          <input type="text" class="form-control" id="industry" name="industry" required>
        </div>
        <div class="form-group">
          <label>Employee Numbers*</label>
          <input type="number" class="form-control" name="employeeNumbers" required>
        </div>
        <div class="form-group">
          <label>Last Year Turnover*</label>
          <input type="number" class="form-control" name="lastYearTurnover" required>
        </div>
        <div class="form-group">
          <label>Website</label>
          <input type="text" class="form-control" name="website">
        </div>        
        <div class="form-group">
          <label class="col-form-label">Products / Services Offered*</label>
          <br><a href="addproduct">Add new product</a>
          <div class="input-group">
            <input type="text" class="form-control prodInput" title="Add Product/Service" id="prodServiceInput">
            <br>
            <input type="number" min="1" class="form-control" title="Price" id="price">
            <input type="text" class="form-control" title="Currency" id="currency">
            <div class="input-group-append">
              <button class="btn btn-outline-secondary" type="button" disabled id="addProdService">Add</button>
            </div>
          </div>
          <br>
          <ul class="list-group" id="prodServices">           
          </ul>
          <input type="hidden" required id="prodServicesList" name="productsServicesOffered">
        </div>
        <div class="form-group">
          <label>Capability Description*</label>
          <input type="text" class="form-control" name="capabilityDescription" required>
        </div>
        <div class="form-group">
          <label>Relevant Experience*</label>
          <input type="text" class="form-control" name="relevantExperience" required>
        </div>
        <div class="form-group">
          <label>Supporting Information</label>
          <input type="text" class="form-control" name="supportingInformation">
        </div>
        
        <div class="form-group">
          <label class="text-muted form-text">
            You can upload your files to cloud services (e.g. Google Drive) and add the link to the folder here.
          </label>
        </div>
        
        <div class="form-group">
          <label>Certificates</label>
          <input class="form-control fileupload" type="file" id="certificates" name="certificates" multiple>
          <input class="form-control multiple btn btn-dark mt-2" type="button" disabled value="Upload Files" />
        </div>

        <div class="form-group">
          <label>Antibribery policy</label>
          <input class="form-control fileupload" type="file" id="antibriberyPolicy" name="antibriberyPolicy"/>
          <input class="form-control single btn btn-dark mt-2" type="button" disabled value="Upload File" />
        </div>

        <div class="form-group">
          <label>Environment policy</label>
          <input class="form-control fileupload" type="file" id="environmentPolicy" name="environmentPolicy"/>
          <input class="form-control single btn btn-dark mt-2" type="button" disabled value="Upload File" />
        </div>

        <div class="form-group">
          <label>Quality management policy</label>
          <input class="form-control fileupload" type="file" id="qualityManagementPolicy"
            name="qualityManagementPolicy"/>
          <input class="form-control single btn btn-dark mt-2" type="button" disabled value="Upload File" />
        </div>

        <div class="form-group">
          <label>Occupational Safety and Health</label>
          <input class="form-control fileupload" type="file" id="occupationalSafetyAndHealthPolicy"
            name="occupationalSafetyAndHealthPolicy"/>
          <input class="form-control single btn btn-dark mt-2" type="button" disabled value="Upload File" />
        </div>

        <div class="form-group">
          <label>Other relevant files</label>
          <input class="form-control fileupload" type="file" id="otherRelevantFiles" name="otherRelevantFiles" multiple>
          <input class="form-control multiple btn btn-dark mt-2" type="button" disabled value="Upload Files" />
        </div>

        <!--Mandatory check of agreements -->
        <div class="form-group">
          <div class="form-check">
            <input class="form-check-input cb" name="UNITETermsAndConditions" id="termscon" type="checkbox" required>
            <a href="../termsConditions">
              <label class="form-check-label cb" for="termscon">
                UNITE Terms And Conditions
              </label>
            </a>
          </div>
        </div>
        
        <div class="form-group">
          <div class="form-check">
            <input class="form-check-input cb" name="antibriberyAgreement" id="antibrib" type="checkbox" required>          
            <a href="../antibriberyAgreement">
              <label class="form-check-label cb" for="antibrib">
                Antibribery Agreement
              </label>
            </a>
          </div>
        </div>

        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
        <button disabled id="submit" type="submit" class="btn btn-primary btn-block">Sign Up</button>
        <div class="form-group">
          <label class="text-muted form-text">
            By clicking the "Sign Up" button, you accept <a href="../termsConditions">the UNITE Terms And Conditions</a> and <a href="../antibriberyAgreement">the Antibribery Agreement</a>.
          </label>
        </div>
      </form>
    </div>
  </div>  
</body>

</html>