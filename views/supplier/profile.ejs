<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Supplier Profile - UNITE</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="A cool thing made with Glitch">
  <link id="favicon" rel="icon" href="https://glitch.com/edit/favicon-app.ico" type="image/x-icon">
  <link rel="stylesheet" href="/style.css">
  <link rel="stylesheet" href="/messages.css">
  <link rel="stylesheet" href="/jquery-ui.css">
  <link rel="stylesheet" href="/bootstrap.min.css">
  <script src="/jquery.min.js"></script>
  <script src="/jquery-ui.min.js"></script>
  <script src="/popper.min.js"></script>
  <script src="/bootstrap.min.js"></script>
  <script src="/sweetalert2@9.min.js"></script>
  <script src="/index.min.js"></script>
  <script src="/money.min.js"></script>
  <script src="/https.js"></script>
  <script src="/chatUsers.js"></script>
  <script src="/autocomp.js"></script>
  <script type="text/javascript">
    $(document).ready(function () {
      var token = $("input[name='_csrf']").val();
      
      postAutocomplete('.country', '/countryAutocomplete', token);
      getAutocomplete('#industry', '/industryGetAutocomplete', token);
      //getAutocomplete('#currency', '/currencyGetAutocomplete', token);
      errorSuccess(Swal, '<%= errorMessage %>', '<%= successMessage %>');
      getCurrenciesList('select.currency', '/currencyGetAutocomplete', token);
      initBaseRates(fx, 'select.currency');
      $('select.currency').css('width', '100px');
      var defaultCurr = "<%= profile.currency %>";
      
      $("input,textarea,select").on('change', function () {
        $('#updateProfile').removeAttr('disabled');
      });
      
      /*
      $("#prodServiceInput").on("paste", function(e) {
          // access the clipboard using the api
          var pastedData = e.originalEvent.clipboardData.getData('text');
          alert(pastedData);
      });
      
      function treatPaste(txt) {
      }*/      
      
      $('#updateProfile').click(function() {
        if(!supplierValidateFields(fx))
          return false;
      });

    $('#prodServiceInput').on('change', function() {
      if($(this).val()) {
        $('#addProdService').prop('disabled', false);
      } else {
        $('#addProdService').prop('disabled', true);
      }
    });
      
        $('#termination').click(function(e) {
          $("#dialog").dialog({
            modal: true,
            width: 300,
            height: 550,
            open: function(event, ui) {
              $('#dialog').append('<p>Are you sure you want to delete your Supplier account?<br>This will also remove:<br>Your products/services;<br>Your capabilities;<br>Your received orders;<br>Your user tokens (if any);<br>Your message history from UNITE.<br><br>If you just want to take a break, you may' + '<a href="deactivate/<%= profile._id %>"'
                    + ' deactivate your account</a>' +' deactivate your account instead.</p>');
            },
            close: function(event, ui) {
                $('#dialog').text('');
              },
            buttons: {
              OK: function() {
                setTimeout(function() {
                  $('#termination').next('form').submit();
                }, 150);
                $(this).dialog("close");
              },              
              Cancel: function() {
                $('#dialog').text('');
                $(this).dialog("close");
              }
            }
          });
      });
    
    var MAX = parseInt("<%= MAX_PROD %>");
    $("#prodServices").attr('MAX', MAX);
    addProduct($("#addProdService"));
  });
  </script>
</head>

<body>
  <nav pos="4" user="supplier" class="navbar navbar-expand-lg navbar-dark bg-dark">
    <a class="navbar-brand" href="/supplier">Supplier - UNITE</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
  </nav>

  <div class="container">
    <br><br>
    <div class="card">
      <h5 class="card-header">Welcome!</h5>
      <div class="card-body">
        <h5 class="card-title">Hello, <%= profile.companyName %>!</h5>
        <p class="card-text">This is your profile page. In order to ensure that you continue to appear in the search results of buyers, please keep your capabilities up-to-date.</p>
      </div>
    </div>
    
    <br>
    <br>
    <div class="smooth-shadow profile-form">
      <form method="post">
        <input type="hidden" name="_id" value="<%= profile._id %>">
        <input type="hidden" name="role" value="<%= profile.role %>">
        <input type="hidden" id="balance" name="balance" value="<%= profile.balance %>">
        <input type="hidden" name="createdAt" id="createdAt" value="<%= profile.createdAt %>">        
        
        <div class="form-group">
          <label>Company Name*</label>
          <input required type="text" id="companyName" name="companyName" class="form-control"
            value="<%= profile.companyName %>">
        </div>
        <div class="form-group">
          <label>Email address*</label>
          <input required type="email" id="emailAddress" name="emailAddress" class="form-control"
            value="<%= profile.emailAddress %>">
          <small class="text-muted form-text">Only companies' domains are allowed.</small>
        </div>
        <div class="form-group">
          <label>Password*</label>
          <input required type="password" id="password" name="password" pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{6,}" title="Please type at least one number and one uppercase&lowercase letter, and at least 6 characters" class="form-control" value="<%= profile.password %>">
          <a href="forgotPassword"><label>Forgot your password?</label></a>
        </div>
        <input type="hidden" name="isVerified" id="isVerified" value="<%= profile.isVerified %>">
        <div class="form-group">
          <label>Director's name*</label>
          <input required type="text" class="form-control" id="directorsName" name="directorsName" value="<%= profile.directorsName %>">
        </div>
        <div class="form-group">
          <label>Contact Name*</label>
          <input required type="text" class="form-control" id="contactName" name="contactName" value="<%= profile.contactName %>">
        </div>
        <div class="form-group">
          <label>Title*</label>
          <input required type="text" class="form-control" id="title" name="title" value="<%= profile.title %>">
        </div>
        <div class="form-group">
          <label>Company Registration No</label>
          <input type="text" class="form-control" id="companyRegistrationNo" name="companyRegistrationNo" value="<%= profile.companyRegistrationNo %>" required>
        </div>
        <div class="form-group">
          <label>Registered Country*</label>
          <input type="text" class="form-control country" id="registeredCountry" name="registeredCountry" value="<%= profile.registeredCountry %>" required>
        </div>
        <div class="form-group">
          <label>Company Address*</label>
          <input type="text" class="form-control" id="companyAddress" name="companyAddress" value="<%= profile.companyAddress %>" required>
        </div>
        <div class="form-group">
          <label>Area Covered*</label>
          <input required type="text" class="form-control" id="areaCovered" name="areaCovered" value="<%= profile.areaCovered %>">
        </div>
        <div class="form-group">
          <label>Contact Mobile Number*</label>
          <input type="tel" class="form-control" title="Please write the number as +XX XXX XXX XXX" pattern="\+[0-9]{2} [0-9]{3} [0-9]{3} [0-9]{3}" id="contactMobileNumber" placeholder="+XX XXX XXX XXX" name="contactMobileNumber" value="<%= profile.contactMobileNumber %>" required>
        </div>
        <div class="form-group">
          <label>Preferred Currency (Default: Euro)*</label>
          <input type="hidden" name="currency" value="<%= profile.currency %>" required><br>
          <select class="currency" class="form-control" title="Currency" value="<%= profile.currency %>" required></select>
        </div>
        <div class="form-group">
          <label>Country*</label>
          <input type="text" class="form-control country" id="country" name="country" value="<%= profile.country %>" required>
        </div>
        <div class="form-group">
          <label>Industry*</label>
          <input type="text" class="form-control" id="industry" name="industry" value="<%= profile.industry %>" required>
        </div>
        <div class="form-group">
          <label>Employee Numbers*</label>
          <input type="number" class="form-control" id="employeeNumbers" name="employeeNumbers" value="<%= profile.employeeNumbers %>" required>
        </div>
        <div class="form-group">
          <label>Last Year Turnover*</label>
          <input type="money" class="form-control" id="lastYearTurnover" name="lastYearTurnover" value="<%= profile.lastYearTurnover %>" required>
        </div>
        <div class="form-group">
          <label>Website</label>
          <input type="url" class="form-control" id="website" name="website" value="<%= profile.website %>">
        </div>
        <div class="form-group">
          <label>Facebook URL</label>
          <input type="url" class="form-control" id="facebookURL" name="facebookURL" value="<%= profile.facebookURL %>">
        </div>
        <div class="form-group">
          <label>Instagram URL</label>
          <input type="url" class="form-control" id="instagramURL" name="instagramURL" value="<%= profile.instagramURL %>">
        </div>
        <div class="form-group">
          <label>Twitter URL</label>
          <input type="url" class="form-control" id="twitterURL" name="twitterURL" value="<%= profile.twitterURL %>">
        </div>
        <div class="form-group">
          <label>LinkedIn URL</label>
          <input type="url" class="form-control" id="linkedinURL" name="linkedinURL" value="<%= profile.linkedinURL %>">
        </div>
        <div class="form-group">
          <label>Other Social Media URL</label>
          <input type="url" class="form-control" id="otherSocialMediaURL" name="otherSocialMediaURL" value="<%= profile.otherSocialMediaURL %>">
        </div>
        <div>
          <p>
            You can use an Excel file with your products list, formatted as product name + product price + product currency + product amount (4 cells per row, first row must contain column names), and after you click on the Process button, our system will automatically add the products and build their detailed list on page.
          </p>
        </div>
        <div class="form-group">
          <label>Please choose your prepared product/service list (*.xls/xlsx, name+price+currency+amount on each row):</label>
          <input class="form-control fileexcelupload" type="file" id="products" name="products" single>
          <input class="form-control single btn btn-dark mt-2" type="button" disabled value="Process Excel File" />
        </div>
        <div class="form-group">
          <label class="col-form-label">Products / Services Offered*</label>
          <br><a href="addproduct">Add new product</a>
          <div class="input-group">
            <input type="text" class="form-control prodInput" placeholder="Product*" title="Add Product/Service" id="prodServiceInput">
            <br>
            <input type="number" min="0.1" step="0.1" placeholder="Price*" class="form-control" title="Price" id="price">
            <input type="text" readonly class="form-control" title="Currency" class="currency0" id="currency">
            <br>
            <input type="number" class="form-control" title="Amount" placeholder="Amount" class="amount" id="amount" value="1">
            <div class="input-group-append">
              <button class="btn btn-outline-secondary" type="button" disabled id="addProdService">Add</button>
            </div>
          </div>
          <br>
          <ul class="list-group" id="prodServices">
            <% let i = 0; if (products != null) { for (product of products) { i++; %>
            <li class='list-group-item'>
              <span class='product'><%= product.productName %></span> - <span class='price'><%= product.price %></span> <span class='currency'><%= product.currency %></span> - <span class='amount'><%= product.amount %></span> items (Total: <span class='totalPrice'><%= product.totalPrice %></span> <%= product.currency %>)
              <span class='rem'>&nbsp;&nbsp;(Remove)</span>
            </li>
            <% } }%>
          </ul>
          <input type="hidden" required id="prodServicesList" name="productsServicesOffered" value="<%= profile.productsServicesOffered %>">
          <input type="hidden" name="pricesList" id="pricesList" value="<%= profile.pricesList %>">
          <input type="hidden" name="currenciesList" id="currenciesList" value="<%= profile.currenciesList %>">
          <input type="hidden" name="amountsList" id="amountsList" value="<%= profile.amountsList %>">
        </div>
        <div class="form-group">
          <label>Total Price of Supply*</label>
          <span type="text" class="form-control" id="totalSupplyPrice" name="totalSupplyPrice"></span>
          <input type="hidden" id="hiddenTotalPrice" value="0">
        </div>
        <div class="form-group">
          <label>Total Amount of Supply*</label>
          <span class="form-control" id="totalSupplyAmount" name="totalSupplyAmount"></span>
        </div>
        <script type="text/javascript">
          bindRemoveProduct($('.rem'), $('#prodServiceInput'), false, null);
          $('<a><span style="color: green; cursor: pointer" id="massRemove">Remove All Products</span></a><br>').insertBefore($("#prodServices"));
          $('#massRemove').on('click', removeAllProducts);
          var totalLoadedPrice = 0, totalLoadedAmount = 0;
          
          $('span.totalPrice').each(function(ind, el) {
            totalLoadedPrice += parseFloat($(el).text());
          });
          
          $('span.amount').each(function(ind, el) {
            totalLoadedAmount += parseInt($(el).text());
          });
          
          $('#hiddenTotalPrice').val(totalLoadedPrice);
          $('#totalSupplyAmount').text(totalLoadedAmount);
          $('#totalSupplyPrice').text(totalLoadedPrice + ' ' + "<%= profile.currency %>");
        </script>
        
        <div class="form-group">
          <label>Capability Description*</label>
          <input type="text" class="form-control" id="capabilityDescription" name="capabilityDescription" value="<%= profile.capabilityDescription %>" required>
        </div>
        <div class="form-group">
          <label>Relevant Experience*</label>
          <textarea required class="form-control" id="relevantExperience" name="relevantExperience"><%= profile.relevantExperience %></textarea>
        </div>
        <div class="form-group">
          <label>Supporting Information</label>
          <input type="text" class="form-control" id="supportingInformation" name="supportingInformation" value="<%= profile.supportingInformation %>">
        </div>

        <!-- Uploading files field section-->
        <div class="form-group">
          <label class="text-muted form-text">
           <!-- You can upload your files to cloud services (e.g. Google Drive) and add the link to the folder here. -->
          </label>
        </div>
        
        <div class="form-group">
          <label>User Avatar</label>
          <input type="hidden" name="avatar" value="<%= profile.avatar %>">
          <input class="form-control fileupload avatarupload" type="file" id="avatar" name="avatarImg">
          <input class="form-control single btn btn-dark mt-2" type="button" disabled value="Upload File" />
        </div>
        
        <div class="form-group">
          <label>Certificates</label>
          <input type="hidden" class="fileId" name="certificatesIds" value="<%= profile.certificatesIds %>">
          <input class="form-control fileupload" type="file" id="certificates" name="certificates" multiple value="<%= profile.certificates %>">
          <input class="form-control multiple btn btn-dark mt-2" type="button" disabled value="Upload Files" />
        </div>

        <div class="form-group">
          <label>Antibribery policy</label>
          <input type="hidden" class="fileId" name="antibriberyPolicyId" value="<%= profile.antibriberyPolicyId %>">
          <input class="form-control fileupload" type="file" id="antibriberyPolicy" name="antibriberyPolicy" value="<%= profile.antibriberyPolicy %>">
          <input class="form-control single btn btn-dark mt-2" type="button" disabled value="Upload File" />
        </div>

        <div class="form-group">
          <label>Environment policy</label>
          <input type="hidden" class="fileId" name="environmentPolicyId" value="<%= profile.environmentPolicyId %>">
          <input class="form-control fileupload" type="file" id="environmentPolicy" name="environmentPolicy" value="<%= profile.environmentPolicy %>">
          <input class="form-control single btn btn-dark mt-2" type="button" disabled value="Upload File" />
        </div>

        <div class="form-group">
          <label>Quality management policy</label>
          <input type="hidden" class="fileId" name="qualityManagementPolicyId" value="<%= profile.qualityManagementPolicyId %>">
          <input class="form-control fileupload" type="file" id="qualityManagementPolicy" name="qualityManagementPolicy" value="<%= profile.qualityManagementPolicy %>">
          <input class="form-control single btn btn-dark mt-2" type="button" disabled value="Upload File" />
        </div>

        <div class="form-group">
          <label>Occupational Safety and Health</label>
          <input type="hidden" class="fileId" name="occupationalSafetyAndHealthPolicyId" value="<%= profile.occupationalSafetyAndHealthPolicyId %>">
          <input class="form-control fileupload" type="file" id="occupationalSafetyAndHealthPolicy" name="occupationalSafetyAndHealthPolicy" value="<%= profile.occupationalSafetyAndHealthPolicy %>">
          <input class="form-control single btn btn-dark mt-2" type="button" disabled value="Upload File" />
        </div>

        <div class="form-group">
          <label>Other relevant files</label>
          <input type="hidden" class="fileId" name="otherRelevantFilesIds" value="<%= profile.otherRelevantFilesIds %>">
          <input class="form-control fileupload" type="file" id="otherRelevantFiles" name="otherRelevantFiles" multiple value="<%= profile.otherRelevantFiles %>">
          <input class="form-control multiple btn btn-dark mt-2" type="button" disabled value="Upload Files" />
        </div>
        
        <div class="form-group">
          <label>Date Created</label>
          <input type="text" disabled class="form-control" id="dateCreated" name="createdAtFormatted" value="<%= profile.createdAtFormatted %>">
        </div>

        <!--Mandatory check of agreements -->
        <div class="form-group">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="UNITETermsAndConditions" name="UNITETermsAndConditions"
              <%= profile.UNITETermsAndConditions ? "checked" : "" %> required>
            <label class="form-check-label" for="UNITETermsAndConditions">
              <a href="../termsConditions">UNITE Terms And Conditions</a>
            </label>
          </div>
        </div>
        <div class="form-group">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="antibriberyAgreement" name="antibriberyAgreement"
              <%= profile.antibriberyAgreement ? "checked" : "" %> required>
            <label class="form-check-label" for="antibriberyAgreement">
              <a href="../antibriberyAgreement">Antibribery Agreement</a>
            </label>
          </div>
        </div>
        <br>
        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
        <button type="submit" disabled id="updateProfile" value="Update Profile"
          class="btn btn-primary btn-block btn-lg">Update Profile</button>
      </form>
        <br><br>
        <div class="form-group mr-2">          
          <a href="deactivate/<%= profile._id %>"><button class="btn-secondary btn" id="deactivation" title="Temporarily deactivate your Account">Deactivate Account</button></a>
        </div>
        <div class="form-group mr-2">
          <br>
          <button class="btn-secondary btn" id="termination" title="Close Account">Delete Account</button>
          <form action="delete/<%= profile._id %>">
          </form>
        </div>
        <div id="dialog">
        </div>
  </div>
</body>

</html>